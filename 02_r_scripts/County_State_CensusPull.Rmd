---
title: "Dem_Info_Datasets"
author: "Christian Hosam"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r package imports, echo=FALSE}
#install.packages("tidycensus")
#remotes::install_github("kuriwaki/ccesMRPprep")
#install.packages("censusapi")
library(tidycensus)
library(tidyverse)
library(readxl)
library(haven)
library(janitor)
library(ccesMRPprep)
library(censusapi)
#Set Census API Key
#census_api_key("ce7de3bc25a542caf03e607ec3c2b6f33fee1bc3", install = TRUE)
```

```{r Census API Call Look-Up, include=TRUE}
#Creating Reference Table to Look Up ACS Variable Code Names (Using Shiro Kuriwaki CCES Package)
acs_reference <- acscodes_df
view(acs_reference)

#Using Native Version of Look Up Codes from TidyCensus 
var21 <- load_variables(2021, "acs1", cache = TRUE)
view(var21)

```

```{r Initial State-Level Call, include=TRUE}
#Create variable list of co-variates located in Census files for both states and counties
my_variables <- c(educ_att_hs = "B15003_017",
                   educ_att_ba = "B15003_022",
                   priv_health_coverage = "B27011_001",
                   pub_health_coverage = "B27003_001",
                   mcaid_health_coverage = "B27007_001",
                   mcare_healh_coverage = "B27006_001",
                   directp_health_coverage = "B27005_001",
                   employer_health_coverage = "B27004_001",
                   no_health_insurance = "B992701_003",
                   blk_pop = "B02001_003",
                   pub_assist = "B19058_002",
                   female_hh = "B11001_006",
                   unemp = "B23025_005",
                   povrate = "B07012_002",
                   medinchh = "B19013_001",
                   giniineq = "B19083_001")


state_demographics <- get_acs(geography = "state",
                            year = 2021, 
                            survey = "acs1",
                            variables = my_variables,
                            summary_var = "B02001_001",
                            output = "wide")

state_demographics <- state_demographics %>%
  rename("total_pop" = "summary_est")
view(state_demographics)

#Write a CSV File
#write_csv(state_demographics, "state_demographics.csv")
```

```{r Initial County-Level Call, include=TRUE}
#Include Summary Var to have 
county_demographics <- get_acs(geography = "county",
                               year = 2021,
                               survey = "acs1",
                               variables = my_variables,
                               summary_var = "B02001_001",
                               output = "wide")

county_demographics <- county_demographics %>%
  rename("total_pop" = "summary_est")


view(county_demographics)

#write_csv(county_demographics, "county_demographics.csv")
```


```{r Cut County-Level Call to Size, include=TRUE}
#First, I'll separate out the county names from the state names
county_demographics <- separate(
  county_demographics,
  NAME,
  into = c("county", "state"),
  sep = ", "
)

#Now, I'll create a column that calculates Black population percentage rather than simple population number
county_demographics <- county_demographics %>%
  mutate(pct_blk = 100 * ( blk_popE / total_pop))

#Next, I'll write a function to cut down the county dataset to only three counties per state with the counties that have the highest percentage of Black people 

cleaned_counties <- county_demographics %>% 
  # Group by state
  group_by(state) %>% 
  # Sort by pct_blk_e in descending order
  arrange(desc(pct_blk)) %>% 
  # Select the top 3 rows for each state
  slice(1:3)

view(cleaned_counties)
#write_csv(cleaned_counties, "Counties_Demo.csv")
```

```{r Import Health Resources Data, include=TRUE}

```

